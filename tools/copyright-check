#!/bin/sh
#
# copyright-check
#
# This script should be invoked from the top-level directory; e.g.
# run "tools/copyright-check".
#

for dir in `echo include machine kernel common test tools wpcsound`; do
	cd $dir
	for f in `find . -name "*.[ch]" -newer ../tools/timestamp.2007`; do
		echo -n "Checking $dir/$f ... "
		grep "Copyright.*2007" $f > /dev/null 2>&1
		if [ "$?" != "0" ]; then
			grep "Copyright.*2006" $f > /dev/null 2>&1
			if [ "$?" != "0" ]; then
				echo "No copyright at all!";
			else
				echo "Copyright needs updating";
				sed -i -e "s/Copyright.*2006/&, 2007/" $f
			fi
		else
			echo "OK";
		fi
	done
	cd ..
done
