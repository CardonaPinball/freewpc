
<h1>GCC for the 6809 Processor</h1>

<p><b>FreeWPC</b> uses a port of the GNU C Compiler (gcc) to the 6809.
This port is not officially part of gcc, and exists "out of tree".
However, I have found that it works pretty well, after making some
modifications to it.

<p>This documentation describes some of the limitations of the C
compiler, how you should be careful when coding performance critical
routines, and some of the changes that I made to it specifically for
this project, which may or may not be of use to others.

<h2>Basic Types</h2>

<p>For performance, we take care to use the smallest data type that will
work.  Wherever possible, we use unsigned 8-bit values (<b>U8</b>).
This maps to the C <b>unsigned int</b> type. 
There is only one register that can be used for
this purpose, the B register, so it should not be used unless necessary.
Future versions of the compiler may also use the A register for this
type.  If you need 16-bit data, you should use <b>U16</b>, or
<b>long</b>.

<h2>Argument Passing Conventions</h2>

<p>gcc6809 supports a number of options for how to pass arguments
to subroutines.  For compatibility with older releases, there are
options to avoid argument passing in registers, however, by default
gcc will put 1 or 2 arguments into registers, then pass everything
else on the stack.  This yields the best performance.

<p>I made one change to the gcc core to reduce the amount of stack
space that it will use before popping arguments.  Normally, gcc will
keep arguments on the stack for some time, and then try to pop lots of
the arguments at once, to reduce the number of pop instructions.
Because the FreeWPC kernel only gives each task a very small amount of stack
space, this can lead to stack overflow pretty quickly with the default
values.  In my gcc6809 tree, the stack will pop once the argument size
exceeds 8 bytes.  This still allows for some combining of pop instructions
across multiple calls.

<h2>Register Usage</h2>

<h2>Stack Usage</h2>

<h2>Using the <i>section</i> attribute</h2>

<h2>Using Inline Assembly</h2>

<h2>References</h2>

<ul>
<li><a href="">GCC Internals Manual</a>
</ul>
